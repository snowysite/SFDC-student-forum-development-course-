<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexora - Course Study Forum</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .post-card {
            transition: all 0.2s ease;
        }
        .post-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-orange-50 to-red-100 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-black shadow-lg border-b-2 border-orange-600">
        <div class="max-w-6xl mx-auto px-2 sm:px-4">
            <div class="flex justify-between items-center py-3 sm:py-4">
                <div class="flex items-center space-x-2 sm:space-x-3">
                    <div class="w-8 h-8 sm:w-10 sm:h-10 bg-gradient-to-r from-orange-500 to-red-600 rounded-lg flex items-center justify-center">
                        <span class="text-white font-bold text-sm sm:text-lg">üìö</span>
                    </div>
                    <h1 class="text-lg sm:text-2xl font-bold text-white">Nexora</h1>
                </div>
                <div class="flex items-center space-x-2 sm:space-x-4">
                    <span id="userWelcome" class="text-gray-300 hidden text-xs sm:text-sm">Welcome back!</span>
                    <button id="loginBtn" class="bg-gradient-to-r from-orange-500 to-red-600 text-white px-2 py-1 sm:px-4 sm:py-2 rounded-lg hover:from-orange-600 hover:to-red-700 transition-colors text-sm sm:text-base">
                        Login
                    </button>
                    <button id="logoutBtn" class="bg-gray-700 text-white px-2 py-1 sm:px-4 sm:py-2 rounded-lg hover:bg-gray-800 transition-colors hidden text-sm sm:text-base">
                        Logout
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-6xl mx-auto px-2 sm:px-4 lg:px-6 py-4 sm:py-6 lg:py-8">
        <!-- Login Modal -->
        <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden p-2 sm:p-4">
            <div class="bg-white rounded-xl p-4 sm:p-6 lg:p-8 max-w-md w-full mx-2 sm:mx-4 fade-in">
                <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-4 sm:mb-6 text-center">Join Nexora</h2>
                <form id="loginForm">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Your Name</label>
                        <input type="text" id="userName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-indigo-500" placeholder="Enter your name" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Course/Subject</label>
                        <input type="text" id="userCourse" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-indigo-500" placeholder="e.g., Computer Science 101" required>
                    </div>
                    <div class="flex space-x-3">
                        <button type="submit" class="flex-1 bg-gradient-to-r from-orange-500 to-red-600 text-white py-2 rounded-lg hover:from-orange-600 hover:to-red-700 transition-colors">
                            Join Forum
                        </button>
                        <button type="button" id="cancelLogin" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400 transition-colors">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Welcome Section -->
        <div id="welcomeSection" class="text-center mb-6 sm:mb-8">
            <h2 class="text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-800 mb-3 sm:mb-4 px-2">Share Knowledge, Ace Your Exams! üéì</h2>
            <p class="text-base sm:text-lg lg:text-xl text-gray-600 mb-4 sm:mb-6 px-2">Upload answers, share study materials, and help your coursemates succeed</p>
            <div class="bg-white rounded-xl p-4 sm:p-6 shadow-lg border border-orange-200">
                <p class="text-gray-700 mb-4 text-sm sm:text-base">Please login to start sharing and viewing study materials</p>
                <button onclick="document.getElementById('loginBtn').click()" class="bg-gradient-to-r from-orange-500 to-red-600 text-white px-4 py-2 sm:px-6 sm:py-3 rounded-lg hover:from-orange-600 hover:to-red-700 transition-colors font-semibold text-sm sm:text-base">
                    Get Started
                </button>
            </div>
        </div>

        <!-- Main Forum Content -->
        <div id="forumContent" class="hidden">
            <!-- Create Post Section -->
            <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-6 sm:mb-8 border border-orange-200">
                <h3 class="text-lg sm:text-xl font-bold text-gray-800 mb-3 sm:mb-4">üìù Share Your Answer</h3>
                <form id="postForm">
                    <div class="mb-3 sm:mb-4">
                        <label class="block text-gray-700 text-xs sm:text-sm font-bold mb-2">Question/Topic</label>
                        <input type="text" id="postTitle" class="w-full px-2 sm:px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-500 text-sm sm:text-base" placeholder="What question are you answering?" required>
                    </div>
                    <div class="mb-3 sm:mb-4">
                        <label class="block text-gray-700 text-xs sm:text-sm font-bold mb-2">Your Answer</label>
                        <textarea id="postContent" rows="3" class="w-full px-2 sm:px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-500 text-sm sm:text-base sm:rows-4" placeholder="Share your detailed answer here..." required></textarea>
                    </div>
                    <div class="mb-3 sm:mb-4">
                        <label class="block text-gray-700 text-xs sm:text-sm font-bold mb-2">Upload Image (Optional)</label>
                        <input type="file" id="postImage" accept="image/*" class="w-full px-2 sm:px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-500 text-xs sm:text-sm">
                        <p class="text-xs sm:text-sm text-gray-500 mt-1">Upload diagrams, screenshots, or handwritten solutions</p>
                    </div>
                    <div class="mb-4 sm:mb-6">
                        <label class="block text-gray-700 text-xs sm:text-sm font-bold mb-2">Subject Tag</label>
                        <select id="postSubject" class="w-full px-2 sm:px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-500 text-sm sm:text-base" required>
                            <option value="">Select Subject</option>
                            <option value="Mathematics">Mathematics</option>
                            <option value="Physics">Physics</option>
                            <option value="Chemistry">Chemistry</option>
                            <option value="Computer Science">Computer Science</option>
                            <option value="Biology">Biology</option>
                            <option value="Engineering">Engineering</option>
                            <option value="Business">Business</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <button type="submit" class="w-full sm:w-auto bg-gradient-to-r from-orange-500 to-red-600 text-white px-4 py-2 sm:px-6 sm:py-2 rounded-lg hover:from-orange-600 hover:to-red-700 transition-colors font-semibold text-sm sm:text-base">
                        üì§ Share Answer
                    </button>
                </form>
            </div>

            <!-- Stats Section -->
            <div class="bg-white rounded-xl shadow-lg p-3 sm:p-4 mb-4 sm:mb-6 border border-orange-200">
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4">
                    <div class="flex items-center justify-center sm:justify-start space-x-4 sm:space-x-6">
                        <div class="text-center">
                            <div class="text-lg sm:text-2xl font-bold text-orange-600" id="totalPosts">0</div>
                            <div class="text-xs sm:text-sm text-gray-600">Total Answers</div>
                        </div>
                        <div class="text-center">
                            <div class="text-lg sm:text-2xl font-bold text-red-600" id="activeUsers">0</div>
                            <div class="text-xs sm:text-sm text-gray-600">Contributors</div>
                        </div>
                        <div class="text-center">
                            <div class="text-lg sm:text-2xl font-bold text-black" id="yourPosts">0</div>
                            <div class="text-xs sm:text-sm text-gray-600">Your Answers</div>
                        </div>
                    </div>
                    <div class="flex items-center justify-center sm:justify-end space-x-2 text-green-600">
                        <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                        <span class="text-xs sm:text-sm font-semibold">Server Online</span>
                    </div>
                </div>
            </div>

            <!-- Filter Section -->
            <div class="bg-white rounded-xl shadow-lg p-3 sm:p-4 mb-4 sm:mb-6 border border-orange-200">
                <div class="flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-4">
                    <label class="font-semibold text-gray-700 text-sm sm:text-base">Filter by Subject:</label>
                    <select id="filterSubject" class="px-2 sm:px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-500 text-sm sm:text-base">
                        <option value="">All Subjects</option>
                        <option value="Mathematics">Mathematics</option>
                        <option value="Physics">Physics</option>
                        <option value="Chemistry">Chemistry</option>
                        <option value="Computer Science">Computer Science</option>
                        <option value="Biology">Biology</option>
                        <option value="Engineering">Engineering</option>
                        <option value="Business">Business</option>
                        <option value="Other">Other</option>
                    </select>
                    <input type="text" id="searchPosts" placeholder="Search questions..." class="px-2 sm:px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-500 flex-1 min-w-0 text-sm sm:text-base">
                </div>
            </div>

            <!-- Posts Container -->
            <div id="postsContainer" class="space-y-4 sm:space-y-6">
                <!-- Sample posts will be added here -->
            </div>

            <!-- No Posts Message -->
            <div id="noPostsMessage" class="text-center py-8 sm:py-12 hidden px-4">
                <div class="text-4xl sm:text-6xl mb-3 sm:mb-4">üìö</div>
                <h3 class="text-lg sm:text-xl font-bold text-gray-600 mb-2">No study materials yet</h3>
                <p class="text-gray-500 text-sm sm:text-base">Be the first to share an answer and help your coursemates!</p>
            </div>
        </div>
    </div>

    <script>
        // Mini Server System - Centralized Data Management
        class NexoraServer {
            constructor() {
                this.data = {
                    users: [],
                    posts: [],
                    sessions: [],
                    settings: {
                        postIdCounter: 1,
                        userIdCounter: 1,
                        sessionIdCounter: 1
                    }
                };
                this.loadFromStorage();
            }

            // User Management
            registerUser(name, course) {
                const existingUser = this.data.users.find(u => u.name.toLowerCase() === name.toLowerCase());
                if (existingUser) {
                    return { success: false, message: 'User already exists', user: existingUser };
                }

                const newUser = {
                    id: this.data.settings.userIdCounter++,
                    name,
                    course,
                    joinDate: new Date().toISOString(),
                    postsCount: 0,
                    likesReceived: 0,
                    status: 'active'
                };

                this.data.users.push(newUser);
                this.saveToStorage();
                return { success: true, message: 'User registered successfully', user: newUser };
            }

            loginUser(name, course) {
                let user = this.data.users.find(u => u.name.toLowerCase() === name.toLowerCase());
                
                if (!user) {
                    const registerResult = this.registerUser(name, course);
                    user = registerResult.user;
                }

                const session = {
                    id: this.data.settings.sessionIdCounter++,
                    userId: user.id,
                    loginTime: new Date().toISOString(),
                    active: true
                };

                this.data.sessions.push(session);
                this.saveToStorage();
                return { success: true, user, sessionId: session.id };
            }

            logoutUser(sessionId) {
                const session = this.data.sessions.find(s => s.id === sessionId);
                if (session) {
                    session.active = false;
                    session.logoutTime = new Date().toISOString();
                    this.saveToStorage();
                }
                return { success: true };
            }

            // Post Management
            createPost(authorName, title, content, subject, image = null) {
                const author = this.data.users.find(u => u.name === authorName);
                if (!author) {
                    return { success: false, message: 'User not found' };
                }

                const newPost = {
                    id: this.data.settings.postIdCounter++,
                    title,
                    content,
                    author: author.name,
                    authorId: author.id,
                    course: author.course,
                    subject,
                    timestamp: new Date().toISOString(),
                    image,
                    likes: 0,
                    likedBy: [],
                    comments: [],
                    status: 'active'
                };

                this.data.posts.unshift(newPost);
                author.postsCount++;
                this.saveToStorage();
                return { success: true, post: newPost };
            }

            getPosts(filters = {}) {
                let filteredPosts = this.data.posts.filter(post => post.status === 'active');

                if (filters.subject) {
                    filteredPosts = filteredPosts.filter(post => post.subject === filters.subject);
                }

                if (filters.search) {
                    const searchTerm = filters.search.toLowerCase();
                    filteredPosts = filteredPosts.filter(post => 
                        post.title.toLowerCase().includes(searchTerm) ||
                        post.content.toLowerCase().includes(searchTerm) ||
                        post.author.toLowerCase().includes(searchTerm)
                    );
                }

                return { success: true, posts: filteredPosts };
            }

            toggleLike(postId, userName) {
                const post = this.data.posts.find(p => p.id === postId);
                const user = this.data.users.find(u => u.name === userName);
                
                if (!post || !user) {
                    return { success: false, message: 'Post or user not found' };
                }

                const userIndex = post.likedBy.indexOf(userName);
                if (userIndex === -1) {
                    post.likedBy.push(userName);
                    post.likes++;
                } else {
                    post.likedBy.splice(userIndex, 1);
                    post.likes--;
                }

                // Update author's likes received count
                const author = this.data.users.find(u => u.id === post.authorId);
                if (author) {
                    author.likesReceived = this.data.posts
                        .filter(p => p.authorId === author.id)
                        .reduce((total, p) => total + p.likes, 0);
                }

                this.saveToStorage();
                return { success: true, post };
            }

            // Statistics
            getStats() {
                const activeUsers = this.data.users.filter(u => u.status === 'active').length;
                const totalPosts = this.data.posts.filter(p => p.status === 'active').length;
                const activeSessions = this.data.sessions.filter(s => s.active).length;
                const totalLikes = this.data.posts.reduce((total, post) => total + post.likes, 0);

                return {
                    activeUsers,
                    totalPosts,
                    activeSessions,
                    totalLikes,
                    subjects: this.getSubjectStats()
                };
            }

            getSubjectStats() {
                const subjects = {};
                this.data.posts.forEach(post => {
                    if (post.status === 'active') {
                        subjects[post.subject] = (subjects[post.subject] || 0) + 1;
                    }
                });
                return subjects;
            }

            getUserStats(userName) {
                const user = this.data.users.find(u => u.name === userName);
                if (!user) return null;

                const userPosts = this.data.posts.filter(p => p.authorId === user.id && p.status === 'active');
                return {
                    postsCount: userPosts.length,
                    likesReceived: user.likesReceived,
                    joinDate: user.joinDate,
                    subjects: [...new Set(userPosts.map(p => p.subject))]
                };
            }

            // Data Persistence
            saveToStorage() {
                try {
                    localStorage.setItem('nexoraServerData', JSON.stringify(this.data));
                    console.log('‚úÖ Server data saved successfully');
                } catch (error) {
                    console.error('‚ùå Failed to save server data:', error);
                }
            }

            loadFromStorage() {
                try {
                    const savedData = localStorage.getItem('nexoraServerData');
                    if (savedData) {
                        this.data = JSON.parse(savedData);
                        console.log('‚úÖ Server data loaded successfully');
                    } else {
                        this.initializeSampleData();
                    }
                } catch (error) {
                    console.error('‚ùå Failed to load server data:', error);
                    this.initializeSampleData();
                }
            }

            initializeSampleData() {
                // Add sample users
                this.registerUser('Study Helper', 'Mathematics 101');
                this.registerUser('Physics Pro', 'Physics 201');
                this.registerUser('Chemistry Expert', 'Chemistry 301');

                // Add sample posts from different users
                this.createPost('Study Helper', 
                    'How to solve quadratic equations using the quadratic formula?',
                    'The quadratic formula is x = (-b ¬± ‚àö(b¬≤-4ac)) / 2a. Here\'s a step-by-step approach:\n\n1. Identify coefficients a, b, and c\n2. Calculate the discriminant (b¬≤-4ac)\n3. Apply the formula\n4. Simplify the result\n\nExample: For x¬≤ + 5x + 6 = 0\na=1, b=5, c=6\nDiscriminant = 25-24 = 1\nx = (-5 ¬± 1)/2 = -2 or -3',
                    'Mathematics'
                );

                this.createPost('Physics Pro',
                    'Explain Newton\'s Second Law of Motion',
                    'Newton\'s Second Law states that F = ma (Force = mass √ó acceleration)\n\nKey points:\n‚Ä¢ Force is directly proportional to acceleration\n‚Ä¢ Force is directly proportional to mass\n‚Ä¢ If net force is zero, acceleration is zero\n‚Ä¢ Units: Force in Newtons (N), mass in kg, acceleration in m/s¬≤\n\nExample: A 10kg object with 20N force applied will have acceleration of 2 m/s¬≤',
                    'Physics'
                );

                this.createPost('Chemistry Expert',
                    'How to balance chemical equations step by step?',
                    'Balancing chemical equations ensures the law of conservation of mass:\n\n1. Count atoms of each element on both sides\n2. Start with the most complex molecule\n3. Balance one element at a time\n4. Use coefficients, never change subscripts\n5. Check your work\n\nExample: H‚ÇÇ + O‚ÇÇ ‚Üí H‚ÇÇO\nBalanced: 2H‚ÇÇ + O‚ÇÇ ‚Üí 2H‚ÇÇO',
                    'Chemistry'
                );

                // Add some cross-user likes to demonstrate sharing
                this.toggleLike(1, 'Physics Pro');
                this.toggleLike(1, 'Chemistry Expert');
                this.toggleLike(2, 'Study Helper');
                this.toggleLike(2, 'Chemistry Expert');
                this.toggleLike(3, 'Study Helper');
                this.toggleLike(3, 'Physics Pro');

                console.log('‚úÖ Sample data initialized with cross-user interactions');
                console.log('üìä Posts created by different users are now shared globally');
            }

            // Server Status
            getServerStatus() {
                return {
                    status: 'online',
                    uptime: Date.now(),
                    version: '1.0.0',
                    dataSize: JSON.stringify(this.data).length,
                    lastSaved: new Date().toISOString()
                };
            }
        }

        // Initialize Mini Server
        const server = new NexoraServer();
        
        // Application State
        let currentUser = null;
        let currentSession = null;

        // DOM Elements
        const loginModal = document.getElementById('loginModal');
        const loginBtn = document.getElementById('loginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const loginForm = document.getElementById('loginForm');
        const cancelLogin = document.getElementById('cancelLogin');
        const welcomeSection = document.getElementById('welcomeSection');
        const forumContent = document.getElementById('forumContent');
        const userWelcome = document.getElementById('userWelcome');
        const postForm = document.getElementById('postForm');
        const postsContainer = document.getElementById('postsContainer');
        const noPostsMessage = document.getElementById('noPostsMessage');
        const filterSubject = document.getElementById('filterSubject');
        const searchPosts = document.getElementById('searchPosts');

        // Initialize app
        function init() {
            // Check if user session exists
            const savedSession = localStorage.getItem('nexoraSession');
            
            if (savedSession) {
                const sessionData = JSON.parse(savedSession);
                const loginResult = server.loginUser(sessionData.userName, sessionData.userCourse);
                if (loginResult.success) {
                    currentUser = loginResult.user;
                    currentSession = loginResult.sessionId;
                    showForum();
                }
            }
            
            renderPosts();
            
            // Log server status
            console.log('üöÄ Nexora Server Status:', server.getServerStatus());
        }

        // Event Listeners
        loginBtn.addEventListener('click', () => {
            loginModal.classList.remove('hidden');
        });

        cancelLogin.addEventListener('click', () => {
            loginModal.classList.add('hidden');
        });

        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('userName').value.trim();
            const course = document.getElementById('userCourse').value.trim();
            
            if (name && course) {
                const loginResult = server.loginUser(name, course);
                
                if (loginResult.success) {
                    currentUser = loginResult.user;
                    currentSession = loginResult.sessionId;
                    
                    // Save session for persistence
                    localStorage.setItem('nexoraSession', JSON.stringify({
                        userName: name,
                        userCourse: course,
                        sessionId: currentSession
                    }));
                    
                    loginModal.classList.add('hidden');
                    showForum();
                    loginForm.reset();
                    
                    console.log('‚úÖ User logged in:', currentUser.name);
                }
            }
        });

        logoutBtn.addEventListener('click', () => {
            if (currentSession) {
                server.logoutUser(currentSession);
                console.log('‚úÖ User logged out:', currentUser.name);
            }
            
            currentUser = null;
            currentSession = null;
            localStorage.removeItem('nexoraSession');
            showWelcome();
        });

        postForm.addEventListener('submit', (e) => {
            e.preventDefault();
            createPost();
        });

        filterSubject.addEventListener('change', renderPosts);
        searchPosts.addEventListener('input', renderPosts);

        // User management functions (now handled by server)
        function getUserStats(userName) {
            return server.getUserStats(userName);
        }

        // Show/Hide sections
        function showWelcome() {
            welcomeSection.classList.remove('hidden');
            forumContent.classList.add('hidden');
            loginBtn.classList.remove('hidden');
            logoutBtn.classList.add('hidden');
            userWelcome.classList.add('hidden');
            // Still show posts even when not logged in, but hide create post form
            renderPostsForGuests();
        }

        function showForum() {
            welcomeSection.classList.add('hidden');
            forumContent.classList.remove('hidden');
            loginBtn.classList.add('hidden');
            logoutBtn.classList.remove('hidden');
            userWelcome.classList.remove('hidden');
            userWelcome.textContent = `Welcome, ${currentUser.name}!`;
            renderPosts();
        }

        // Render posts for guests (without interaction capabilities)
        function renderPostsForGuests() {
            const stats = server.getStats();
            
            // Show a simplified view of posts for non-logged-in users
            const postsResult = server.getPosts();
            
            if (postsResult.success && postsResult.posts.length > 0) {
                // Create a simple preview section in welcome
                const previewHtml = `
                    <div class="mt-6 sm:mt-8">
                        <h3 class="text-xl sm:text-2xl font-bold text-gray-800 mb-3 sm:mb-4 text-center px-2">Recent Study Materials</h3>
                        <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 border border-orange-200">
                            <div class="grid gap-3 sm:gap-4">
                                ${postsResult.posts.slice(0, 3).map(post => `
                                    <div class="border-l-4 border-orange-500 pl-3 sm:pl-4 py-2">
                                        <h4 class="font-semibold text-gray-800 text-sm sm:text-base">${escapeHtml(post.title)}</h4>
                                        <p class="text-xs sm:text-sm text-gray-600">by ${escapeHtml(post.author)} ‚Ä¢ ${escapeHtml(post.subject)}</p>
                                        <p class="text-xs sm:text-sm text-gray-500 mt-1">${escapeHtml(post.content.substring(0, 100))}...</p>
                                    </div>
                                `).join('')}
                            </div>
                            <div class="text-center mt-3 sm:mt-4 pt-3 sm:pt-4 border-t border-gray-200">
                                <p class="text-gray-600 mb-2 text-sm sm:text-base px-2">Join to see all ${stats.totalPosts} study materials and contribute your own!</p>
                                <button onclick="document.getElementById('loginBtn').click()" class="bg-gradient-to-r from-orange-500 to-red-600 text-white px-3 py-2 sm:px-4 sm:py-2 rounded-lg hover:from-orange-600 hover:to-red-700 transition-colors text-sm sm:text-base">
                                    Join Now
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                // Add preview to welcome section
                const existingPreview = document.getElementById('postsPreview');
                if (existingPreview) {
                    existingPreview.innerHTML = previewHtml;
                } else {
                    const previewDiv = document.createElement('div');
                    previewDiv.id = 'postsPreview';
                    previewDiv.innerHTML = previewHtml;
                    welcomeSection.appendChild(previewDiv);
                }
            }
        }

        // Create new post
        function createPost() {
            const title = document.getElementById('postTitle').value.trim();
            const content = document.getElementById('postContent').value.trim();
            const subject = document.getElementById('postSubject').value;
            const imageFile = document.getElementById('postImage').files[0];
            
            if (!title || !content || !subject || !currentUser) return;
            
            if (imageFile) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const result = server.createPost(currentUser.name, title, content, subject, e.target.result);
                    if (result.success) {
                        renderPosts();
                        postForm.reset();
                        console.log('‚úÖ Post created with image:', result.post.title);
                    }
                };
                reader.readAsDataURL(imageFile);
            } else {
                const result = server.createPost(currentUser.name, title, content, subject);
                if (result.success) {
                    renderPosts();
                    postForm.reset();
                    console.log('‚úÖ Post created:', result.post.title);
                }
            }
        }

        // Update statistics display
        function updateStats() {
            const stats = server.getStats();
            const totalPostsEl = document.getElementById('totalPosts');
            const activeUsersEl = document.getElementById('activeUsers');
            const yourPostsEl = document.getElementById('yourPosts');
            
            if (totalPostsEl) totalPostsEl.textContent = stats.totalPosts;
            if (activeUsersEl) activeUsersEl.textContent = stats.activeUsers;
            if (yourPostsEl && currentUser) {
                const userStats = server.getUserStats(currentUser.name);
                yourPostsEl.textContent = userStats ? userStats.postsCount : 0;
            }
        }

        // Render posts
        function renderPosts() {
            updateStats();
            
            const filterValue = filterSubject.value;
            const searchValue = searchPosts.value.toLowerCase();
            
            const postsResult = server.getPosts({
                subject: filterValue,
                search: searchValue
            });
            
            if (!postsResult.success || postsResult.posts.length === 0) {
                postsContainer.innerHTML = '';
                noPostsMessage.classList.remove('hidden');
                return;
            }
            
            const filteredPosts = postsResult.posts;
            noPostsMessage.classList.add('hidden');
            
            postsContainer.innerHTML = filteredPosts.map(post => `
                <div class="post-card bg-white rounded-xl shadow-lg p-4 sm:p-6 border border-gray-200">
                    <div class="flex items-start justify-between mb-3 sm:mb-4">
                        <div class="flex-1">
                            <h3 class="text-lg sm:text-xl font-bold text-gray-800 mb-2 pr-2">${escapeHtml(post.title)}</h3>
                            <div class="flex flex-wrap items-center gap-2 sm:gap-4 text-xs sm:text-sm text-gray-600">
                                <span class="flex items-center">
                                    <span class="w-2 h-2 bg-orange-500 rounded-full mr-1 sm:mr-2"></span>
                                    ${escapeHtml(post.author)}
                                </span>
                                <span class="hidden sm:inline">${escapeHtml(post.course)}</span>
                                <span class="bg-${getSubjectColor(post.subject)}-100 text-${getSubjectColor(post.subject)}-800 px-2 py-1 rounded-full text-xs font-semibold">
                                    ${escapeHtml(post.subject)}
                                </span>
                                <span class="text-xs">${formatDate(post.timestamp)}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3 sm:mb-4">
                        <p class="text-gray-700 whitespace-pre-wrap leading-relaxed text-sm sm:text-base">${escapeHtml(post.content)}</p>
                    </div>
                    
                    ${post.image ? `
                        <div class="mb-3 sm:mb-4">
                            <img src="${post.image}" alt="Study material" class="max-w-full h-auto rounded-lg border border-gray-200 shadow-sm">
                        </div>
                    ` : ''}
                    
                    <div class="flex items-center justify-between pt-3 sm:pt-4 border-t border-gray-200">
                        <button onclick="toggleLike(${post.id})" class="flex items-center space-x-1 sm:space-x-2 text-gray-600 hover:text-red-500 transition-colors">
                            <span class="text-base sm:text-lg">${post.likedBy.includes(currentUser?.name) ? '‚ù§Ô∏è' : 'ü§ç'}</span>
                            <span class="font-semibold text-sm sm:text-base">${post.likes}</span>
                            <span class="text-xs sm:text-sm">Helpful</span>
                        </button>
                        <div class="flex items-center space-x-1 sm:space-x-2 text-gray-500 text-xs sm:text-sm">
                            <span>üìö</span>
                            <span class="hidden sm:inline">Study Material</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Toggle like
        function toggleLike(postId) {
            if (!currentUser) return;
            
            const result = server.toggleLike(postId, currentUser.name);
            if (result.success) {
                renderPosts();
                console.log('üëç Like toggled for post:', postId);
            }
        }

        // Utility functions
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function formatDate(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diffMs = now - date;
            const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
            const diffDays = Math.floor(diffHours / 24);
            
            if (diffHours < 1) return 'Just now';
            if (diffHours < 24) return `${diffHours}h ago`;
            if (diffDays < 7) return `${diffDays}d ago`;
            return date.toLocaleDateString();
        }

        function getSubjectColor(subject) {
            const colors = {
                'Mathematics': 'blue',
                'Physics': 'purple',
                'Chemistry': 'green',
                'Computer Science': 'indigo',
                'Biology': 'emerald',
                'Engineering': 'orange',
                'Business': 'yellow',
                'Other': 'gray'
            };
            return colors[subject] || 'gray';
        }

        // Data persistence is now handled by the server automatically

        // Initialize the application
        init();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97b1c144e1d0641b',t:'MTc1NzIwMTQzNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
